import{p as be,r as P,c as M,L as B,M as Ne,N as oe,O as Oe,P as Pe,l as Ke,Q as Re,s as j,R as ie,S as ne,q as i,I as q,T as Y,U as Ee,y as Be,V as je,W as he,X as ve,Y as qe,_ as de,v as z,w as $,x as f,z as Z,K as re,B as ue,F as ze,G as He,E as Je,H as Qe,Z as ge}from"./index-573eb4f5.js";import{C as We}from"./Collection-fb203b04.js";import{I as H}from"./Item-93eb4cb0.js";import{g as Xe,m as Ye,b as se,V as L,a as U,c as Ie}from"./VRow-47c118a5.js";import{V as Ze}from"./VForm-81a661f3.js";import{m as $e,u as et,a as tt,b as lt,c as at,d as it}from"./VSelect-ab9df90b.js";import{m as nt,u as ot,V as ce}from"./VTextField-f3aa5c09.js";import{q as rt,n as ut,p as ye,r as st,o as ee}from"./VBtn-5c1037b7.js";import{f as ct}from"./forwardRefs-e658ad70.js";import{u as dt,V as mt,a as pe}from"./VList-aa8fd6b1.js";import{g as ft,a as Ce}from"./VAvatar-756a34bc.js";import{M as ht}from"./ModalConfirm-633c5798.js";import{V as vt}from"./VBreadcrumbs-c0c85e9c.js";import"./index-7d3b2192.js";import"./ssrBoot-22dd81ae.js";import"./VCard-0ce01423.js";const gt=async e=>{try{return await(await Xe("/games",[e])).map(t=>({id:t.id,title:t.name}))}catch(a){console.error(a)}},yt={fetch:gt},pt={props:{nameCollection:{type:String,required:!0},idCollection:{type:Number,required:!0},idItemType:{type:Number,required:!0},idUser:{type:Number,required:!0}},data(){return{item:{},loading:!1,gameOptionSelected:null,gameTypedString:"",igdbGameList:[],igdbGame:{}}},computed:{isValid(){return!!this.igdbGame.title&&this.igdbGame.title.length>0}},methods:{async create(){this.loading=!0;const e={idcollection:this.idCollection,iditemtype:this.idItemType,iduser:this.idUser,title:this.igdbGame.title+"",idigdb:this.igdbGame.id};try{await H.create(e),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(a){console.error(a)}finally{this.loading=!1}},async fetchIgdbGames(e){this.loading=!0;try{const a=await yt.fetch(e);this.igdbGameList=a}catch(a){console.error(a)}finally{this.loading=!1}},async handleGameSelected(e){this.gameOptionSelected=e;const a=this.igdbGameList.find(({id:t})=>t===e);this.igdbGame=a?JSON.parse(JSON.stringify(a,null,2)):{}},async handleGameInput(e){e.data?this.gameTypedString=this.gameTypedString+e.data:this.gameTypedString=this.gameTypedString.substring(0,this.gameTypedString.length-1),this.gameTypedString.length>3&&await this.fetchIgdbGames(this.gameTypedString)},clearGameInput(){this.gameTypedString=""}}};const Ct=(e,a,t)=>e==null||a==null?-1:e.toString().toLocaleLowerCase().indexOf(a.toString().toLocaleLowerCase()),bt=be({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function It(e,a,t){var p;const g=[],n=(t==null?void 0:t.default)??Ct,u=t!=null&&t.filterKeys?oe(t.filterKeys):!1,m=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return g;e:for(let h=0;h<e.length;h++){const[b,w=b]=oe(e[h]),d={},o={};let I=-1;if(a&&!(t!=null&&t.noFilter)){if(typeof b=="object"){const K=u||Object.keys(w);for(const F of K){const J=Oe(w,F,w),R=(p=t==null?void 0:t.customKeyFilter)==null?void 0:p[F];if(I=R?R(J,a,b):n(J,a,b),I!==-1&&I!==!1)R?d[F]=I:o[F]=I;else if((t==null?void 0:t.filterMode)==="every")continue e}}else I=n(b,a,b),I!==-1&&I!==!1&&(o.title=I);const T=Object.keys(o).length,x=Object.keys(d).length;if(!T&&!x||(t==null?void 0:t.filterMode)==="union"&&x!==m&&!T||(t==null?void 0:t.filterMode)==="intersection"&&(x!==m||!T))continue}g.push({index:h,matches:{...o,...d}})}return g}function Vt(e,a,t,g){const n=P([]),u=P(new Map),m=M(()=>g!=null&&g.transform?B(a).map(h=>[h,g.transform(h)]):B(a));Ne(()=>{const h=typeof t=="function"?t():B(t),b=typeof h!="string"&&typeof h!="number"?"":String(h),w=It(m.value,b,{customKeyFilter:{...e.customKeyFilter,...B(g==null?void 0:g.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),d=B(a),o=[],I=new Map;w.forEach(T=>{let{index:x,matches:K}=T;const F=d[x];o.push(F),I.set(F.value,K)}),n.value=o,u.value=I});function p(h){return u.value.get(h.value)}return{filteredItems:n,filteredMatches:u,getMatches:p}}function _t(e,a,t){if(a==null)return e;if(Array.isArray(a))throw new Error("Multiple matches is not implemented");return typeof a=="number"&&~a?i(q,null,[i("span",{class:"v-autocomplete__unmask"},[e.substr(0,a)]),i("span",{class:"v-autocomplete__mask"},[e.substr(a,t)]),i("span",{class:"v-autocomplete__unmask"},[e.substr(a+t)])]):e}const St=be({autoSelectFirst:{type:[Boolean,String]},search:String,...bt({filterKeys:["title"]}),...$e(),...Pe(nt({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ye({transition:!1})},"VAutocomplete"),wt=Ke()({name:"VAutocomplete",props:St(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,a){let{slots:t}=a;const{t:g}=Re(),n=P(),u=j(!1),m=j(!0),p=j(!1),h=P(),b=P(),w=ie(e,"menu"),d=M({get:()=>w.value,set:l=>{var r;w.value&&!l&&((r=h.value)!=null&&r.ΨopenChildren)||(w.value=l)}}),o=j(-1),I=M(()=>{var l;return(l=n.value)==null?void 0:l.color}),T=M(()=>d.value?e.closeText:e.openText),{items:x,transformIn:K,transformOut:F}=dt(e),{textColorClasses:J,textColorStyles:R}=rt(I),C=ie(e,"search",""),c=ie(e,"modelValue",[],l=>K(l===null?[null]:oe(l)),l=>{const r=F(l);return e.multiple?r:r[0]??null}),N=ot(),{filteredItems:te,getMatches:Ve}=Vt(e,x,()=>m.value?"":C.value),k=M(()=>e.hideSelected?te.value.filter(l=>!c.value.some(r=>r.value===l.value)):te.value),_e=M(()=>c.value.map(l=>l.props.value)),Q=M(()=>{var r;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&C.value===((r=k.value[0])==null?void 0:r.title))&&k.value.length>0&&!m.value&&!p.value}),le=M(()=>e.hideNoData&&!x.value.length||e.readonly||(N==null?void 0:N.isReadonly.value)),ae=P(),{onListScroll:Se,onListKeydown:we}=et(ae,n);function xe(l){e.openOnClear&&(d.value=!0),C.value=""}function Fe(){le.value||(d.value=!0)}function ke(l){le.value||(u.value&&(l.preventDefault(),l.stopPropagation()),d.value=!d.value)}function Te(l){var O,s,V;if(e.readonly||N!=null&&N.isReadonly.value)return;const r=n.value.selectionStart,v=c.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(d.value=!0),["Escape"].includes(l.key)&&(d.value=!1),Q.value&&["Enter","Tab"].includes(l.key)&&A(k.value[0]),l.key==="ArrowDown"&&Q.value&&((O=ae.value)==null||O.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(o.value<0){l.key==="Backspace"&&!C.value&&(o.value=v-1);return}const y=o.value,S=c.value[o.value];S&&!S.props.disabled&&A(S),o.value=y>=v-1?v-2:y}if(l.key==="ArrowLeft"){if(o.value<0&&r>0)return;const y=o.value>-1?o.value-1:v-1;c.value[y]?o.value=y:(o.value=-1,n.value.setSelectionRange((s=C.value)==null?void 0:s.length,(V=C.value)==null?void 0:V.length))}if(l.key==="ArrowRight"){if(o.value<0)return;const y=o.value+1;c.value[y]?o.value=y:(o.value=-1,n.value.setSelectionRange(0,0))}}}function Me(l){C.value=l.target.value}function Ae(l){if(he(n.value,":autofill")||he(n.value,":-webkit-autofill")){const r=x.value.find(v=>v.title===l.target.value);r&&A(r)}}function De(){var l;u.value&&(m.value=!0,(l=n.value)==null||l.focus())}function Ge(l){u.value=!0,setTimeout(()=>{p.value=!0})}function Le(l){p.value=!1}function Ue(l){(l==null||l===""&&!e.multiple)&&(c.value=[])}const E=j(!1);function A(l){if(e.multiple){const r=c.value.findIndex(v=>e.valueComparator(v.value,l.value));if(r===-1)c.value=[...c.value,l];else{const v=[...c.value];v.splice(r,1),c.value=v}}else c.value=[l],E.value=!0,C.value=l.title,d.value=!1,m.value=!0,ve(()=>E.value=!1)}return ne(u,(l,r)=>{var v;l!==r&&(l?(E.value=!0,C.value=e.multiple?"":String(((v=c.value.at(-1))==null?void 0:v.props.title)??""),m.value=!0,ve(()=>E.value=!1)):(!e.multiple&&!C.value?c.value=[]:Q.value&&!p.value&&!c.value.some(O=>{let{value:s}=O;return s===k.value[0].value})&&A(k.value[0]),d.value=!1,C.value="",o.value=-1))}),ne(C,l=>{!u.value||E.value||(l&&(d.value=!0),m.value=!l)}),ne(d,()=>{if(!e.hideSelected&&d.value&&c.value.length){const l=k.value.findIndex(r=>c.value.some(v=>r.value===v.value));qe&&window.requestAnimationFrame(()=>{var r;l>=0&&((r=b.value)==null||r.scrollToIndex(l))})}}),ut(()=>{const l=!!(e.chips||t.chip),r=!!(!e.hideNoData||k.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),v=c.value.length>0,O=ce.filterProps(e);return i(ce,Y({ref:n},O,{modelValue:C.value,"onUpdate:modelValue":Ue,focused:u.value,"onUpdate:focused":s=>u.value=s,validationValue:c.externalValue,counterValue:c.value.length,dirty:v,onInput:Me,onChange:Ae,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":d.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!t.selection,"v-autocomplete--selecting-index":o.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:v?void 0:e.placeholder,"onClick:clear":xe,"onMousedown:control":Fe,onKeydown:Te}),{...t,default:()=>i(q,null,[i(tt,Y({ref:h,modelValue:d.value,"onUpdate:modelValue":s=>d.value=s,activator:"parent",contentClass:"v-autocomplete__content",disabled:le.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:De},e.menuProps),{default:()=>[r&&i(mt,{ref:ae,selected:_e.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:s=>s.preventDefault(),onKeydown:we,onFocusin:Ge,onFocusout:Le,onScrollPassive:Se,tabindex:"-1",color:e.itemColor??e.color},{default:()=>{var s,V,y;return[(s=t["prepend-item"])==null?void 0:s.call(t),!k.value.length&&!e.hideNoData&&(((V=t["no-data"])==null?void 0:V.call(t))??i(pe,{title:g(e.noDataText)},null)),i(lt,{ref:b,renderless:!0,items:k.value},{default:S=>{var fe;let{item:_,index:D,itemRef:G}=S;const me=Y(_.props,{ref:G,key:D,active:Q.value&&D===0?!0:void 0,onClick:()=>A(_)});return((fe=t.item)==null?void 0:fe.call(t,{item:_,index:D,props:me}))??i(pe,me,{prepend:W=>{let{isSelected:X}=W;return i(q,null,[e.multiple&&!e.hideSelected?i(at,{key:_.value,modelValue:X,ripple:!1,tabindex:"-1"},null):void 0,_.props.prependIcon&&i(ye,{icon:_.props.prependIcon},null)])},title:()=>{var W,X;return m.value?_.title:_t(_.title,(W=Ve(_))==null?void 0:W.title,((X=C.value)==null?void 0:X.length)??0)}})}}),(y=t["append-item"])==null?void 0:y.call(t)]}})]}),c.value.map((s,V)=>{function y(G){G.stopPropagation(),G.preventDefault(),A(s)}const S={"onClick:close":y,onMousedown(G){G.preventDefault(),G.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},_=l?!!t.chip:!!t.selection,D=_?Ee(l?t.chip({item:s,index:V,props:S}):t.selection({item:s,index:V})):void 0;if(!(_&&!D))return i("div",{key:s.value,class:["v-autocomplete__selection",V===o.value&&["v-autocomplete__selection--selected",J.value]],style:V===o.value?R.value:{}},[l?t.chip?i(st,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:s.title}}},{default:()=>[D]}):i(it,Y({key:"chip",closable:e.closableChips,size:"small",text:s.title,disabled:s.props.disabled},S),null):D??i("span",{class:"v-autocomplete__selection-text"},[s.title,e.multiple&&V<c.value.length-1&&i("span",{class:"v-autocomplete__selection-comma"},[Be(",")])])])})]),"append-inner":function(){var S;for(var s=arguments.length,V=new Array(s),y=0;y<s;y++)V[y]=arguments[y];return i(q,null,[(S=t["append-inner"])==null?void 0:S.call(t,...V),e.menuIcon?i(ye,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:ke,onClick:je,"aria-label":g(T.value),title:g(T.value)},null):void 0])}})}),ct({isFocused:u,isPristine:m,menu:d,search:C,filteredItems:te,select:A},n)}}),xt={class:"text-h4 font-weight-bold"};function Ft(e,a,t,g,n,u){return z(),$(se,null,{default:f(()=>[i(Ie,{class:"text-center"},{default:f(()=>[i(L,{class:"d-flex align-center justify-center"},{default:f(()=>[i(U,null,{default:f(()=>[i(Ze,null,{default:f(()=>[Z("h2",xt,"Agregar un Videojuego a la colección "+re(t.nameCollection),1),i(se,null,{default:f(()=>[i(L,{justify:"center"},{default:f(()=>[i(U,{cols:"8"},{default:f(()=>[i(wt,{label:"Buscar un título",modelValue:n.gameOptionSelected,"onUpdate:modelValue":[a[0]||(a[0]=m=>n.gameOptionSelected=m),u.handleGameSelected],items:n.igdbGameList,variant:"outlined","item-text":"title","item-value":"id",onInput:u.handleGameInput,onBlur:u.clearGameInput},null,8,["modelValue","items","onUpdate:modelValue","onInput","onBlur"])]),_:1})]),_:1}),i(L,{justify:"center"},{default:f(()=>[i(U,{cols:"auto"},{default:f(()=>[i(ee,{class:"ma-4",text:"Cancelar",onClick:a[1]||(a[1]=m=>e.$router.push({name:"CollectionDetails",params:{id:t.idCollection}}))}),i(ee,{disabled:!u.isValid,class:"bg-green ma-4",text:"Guardar",onClick:a[2]||(a[2]=m=>u.create())},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const kt=de(pt,[["render",Ft]]),Tt={props:{id:{type:Number,required:!1},currentTitle:{type:String,required:!1},nameCollection:{type:String,required:!0},idCollection:{type:Number,required:!0},idItemType:{type:Number,required:!0},idUser:{type:Number,required:!0}},components:{ModalConfirm:ht},data(){return{loading:!1,valid:!1,pageTitle:"",title:this.currentTitle||"",typeLabel:e=>ft(e)}},methods:{save(){this.id?this.update():this.create()},async create(){this.loading=!0;try{const e={idcollection:this.idCollection,iditemtype:this.idItemType,iduser:this.idUser,title:this.title};await H.create(e),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},async update(){this.loading=!0;try{await H.update(this.id||0,this.idUser,this.title),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},async del(){this.loading=!0;try{await H.remove(this.id||0,this.idUser),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},cancel(){this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}},computed:{idValid(){return!!this.title&&this.title.length>0}},watch:{currentTitle:{immediate:!0,handler(e){this.title=e}}}},Mt={class:"text-h4 font-weight-bold text-center"};function At(e,a,t,g,n,u){const m=ue("ModalConfirm");return z(),$(se,null,{default:f(()=>[i(Ie,{class:"text-center"},{default:f(()=>[i(L,{justify:"center"},{default:f(()=>[i(U,{cols:"18"},{default:f(()=>[Z("h1",Mt,re(t.id?"Editar":"Agregar nuevo item a "+t.nameCollection),1)]),_:1})]),_:1}),i(L,{justify:"center"},{default:f(()=>[i(U,{cols:"8"},{default:f(()=>[i(ce,{modelValue:n.title,"onUpdate:modelValue":a[0]||(a[0]=p=>n.title=p),label:"Título",required:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),i(L,{class:"justify-center"},{default:f(()=>[i(U,{cols:"8"},{default:f(()=>[Z("p",null,re(n.typeLabel(t.idItemType)),1)]),_:1})]),_:1}),i(L,{justify:"center"},{default:f(()=>[i(U,{cols:"auto"},{default:f(()=>[ze(Z("span",null,[i(m,{buttonOpenText:"Eliminar",buttonOkText:"Eliminar",buttonKoText:"Cancelar",title:`Confirma que deseas eliminar ${n.title}`,description:`El item ${n.title} será eliminado de la colección ${t.nameCollection}.`,onAgree:u.del},null,8,["title","description","onAgree"])],512),[[He,t.id]]),i(ee,{text:"Cancelar",onClick:a[1]||(a[1]=p=>u.cancel()),class:"ma-2"}),i(ee,{text:"Guardar",onClick:a[2]||(a[2]=p=>u.save()),class:"bg-green ma-2",disabled:!u.idValid},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}const Dt=de(Tt,[["render",At]]),Gt={components:{ItemFormGame:kt,ItemFormAny:Dt},data(){var e;return{breadcrumb:[],id:parseInt(this.$route.params.id+""),idCollection:parseInt(this.$route.params.idCollection+""),idUser:parseInt(((e=Je())==null?void 0:e.id)+""),idItemType:0,nameCollection:"",item:{},collection:{},code:"",loading:!1}},methods:{async fetchItem(){this.loading=!0;try{const e=await H.fetch(this.idUser,this.id,null);this.item=e[0],this.idCollection=this.item.idcollection,this.idItemType=this.item.iditemtype,this.nameCollection=this.item.collectionname+"",this.code=Ce(this.item.iditemtype)}catch(e){console.error(e)}finally{this.loading=!1}},async fetchCollection(){this.loading=!0;try{const e=await We.fetch(this.idUser,this.idCollection);this.collection=e[0],this.idItemType=this.collection.iditemtype,this.nameCollection=this.collection.name,this.code=Ce(this.collection.iditemtype)}catch(e){console.error(e)}finally{this.loading=!1}}},async mounted(){this.idCollection&&(await this.fetchCollection(),this.breadcrumb=["Colecciones",this.collection.name,"Item","Nuevo"]),this.id&&(await this.fetchItem(),this.breadcrumb=["Colecciones",this.nameCollection+"",this.item.title,"Editar"])}};function Lt(e,a,t,g,n,u){var h,b;const m=ue("ItemFormGame"),p=ue("ItemFormAny");return z(),Qe(q,null,[i(vt,{items:n.breadcrumb},null,8,["items"]),n.code==="videogame"?(z(),$(m,{key:0,"id-collection":n.idCollection,"id-user":n.idUser,"id-item-type":n.idItemType,"name-collection":n.nameCollection},null,8,["id-collection","id-user","id-item-type","name-collection"])):ge("",!0),n.code!=="videogame"?(z(),$(p,{key:1,id:(h=n.item)==null?void 0:h.id,"current-title":(b=n.item)==null?void 0:b.title,"id-collection":n.idCollection,"id-user":n.idUser,"id-item-type":n.idItemType,"name-collection":n.nameCollection},null,8,["id","current-title","id-collection","id-user","id-item-type","name-collection"])):ge("",!0)],64)}const Yt=de(Gt,[["render",Lt]]);export{Yt as default};

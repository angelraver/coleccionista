import{p as Ve,r as B,c as E,M as Q,N as Re,O as he,P as Be,Q as ze,l as Ye,R as He,s as W,S as de,T as me,q as l,I as z,U as ne,V as Je,y as ve,W as Qe,X as Ce,Y as be,Z as We,_ as ee,v as F,w as L,x as r,z as O,K as X,$ as Xe,B as N,H as xe,J as Ze,F as we,G as ke,E as $e,L as fe}from"./index-bd743e3f.js";import{C as et}from"./Collection-1e2c47a7.js";import{I as M}from"./Item-f8270f19.js";import{g as tt,b as Z,V as g,a as p,c as oe}from"./VRow-c0a7ebda.js";import{V as lt}from"./VForm-e1bd1189.js";import{m as it,u as at,a as nt,b as rt,c as ot,d as st}from"./VSelect-8dee1675.js";import{m as ut,u as ct,V as $}from"./VTextField-87f0aff2.js";import{q as dt,n as mt,p as re,r as ft,o as P}from"./VBtn-4cad1b59.js";import{f as ht}from"./forwardRefs-e658ad70.js";import{u as vt,V as yt,a as _e}from"./VList-552ea446.js";import{m as gt,V as pt}from"./VImg-91d306b2.js";import{g as Se,a as Ie}from"./ItemType-548fac8d.js";import{M as ye}from"./ModalConfirm-8d3eaf2a.js";import{V as Ct}from"./VCard-bdbbbb42.js";import{V as bt}from"./VBreadcrumbs-dd4ba5e8.js";import"./VOverlay-c6b5d78b.js";import"./index-0659ef7c.js";import"./ssrBoot-bb54221d.js";function _t(e){const i=e*1e3;return new Date(i).getFullYear()}const It=async(e,i)=>{try{return await(await tt("/games",[e,i+""])).map(d=>({id:d.id,title:d.name,year:_t(d.first_release_date)}))}catch(t){console.error(t)}},Vt={fetch:It},xt={props:{nameCollection:{type:String,required:!0},idCollection:{type:Number,required:!0},idItemType:{type:Number,required:!0},idPlatform:{type:Number,required:!0},idUser:{type:Number,required:!0}},data(){return{item:{},loading:!1,gameOptionSelected:null,gameTypedString:"",igdbGameList:[],igdbGame:{}}},computed:{isValid(){return!!this.igdbGame.title&&this.igdbGame.title.length>0}},methods:{async create(){this.loading=!0;const e={idcollection:this.idCollection,iditemtype:this.idItemType,iduser:this.idUser,title:this.igdbGame.titleSimple+"",idigdb:this.igdbGame.id,year:this.igdbGame.year};try{await M.create(e),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(i){console.error(i)}finally{this.loading=!1}},async fetchIgdbGames(e){this.loading=!0;try{const i=await Vt.fetch(e,this.idPlatform);this.igdbGameList=i.map(t=>({id:t.id,title:`${t.title} (${t.year})`,titleSimple:t.title,author:"",year:t.year}))}catch(i){console.error(i)}finally{this.loading=!1}},async handleGameSelected(e){this.gameOptionSelected=e;const i=this.igdbGameList.find(({id:t})=>t===e);this.igdbGame=i?JSON.parse(JSON.stringify(i,null,2)):{}},async handleGameInput(e){e.data?this.gameTypedString=this.gameTypedString+e.data:this.gameTypedString=this.gameTypedString.substring(0,this.gameTypedString.length-1),this.gameTypedString.length>3&&await this.fetchIgdbGames(this.gameTypedString)},clearGameInput(){this.gameTypedString=""}}};const wt=(e,i,t)=>e==null||i==null?-1:e.toString().toLocaleLowerCase().indexOf(i.toString().toLocaleLowerCase()),kt=Ve({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function St(e,i,t){var C;const d=[],a=(t==null?void 0:t.default)??wt,o=t!=null&&t.filterKeys?he(t.filterKeys):!1,m=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return d;e:for(let s=0;s<e.length;s++){const[I,w=I]=he(e[s]),f={},u={};let _=-1;if(i&&!(t!=null&&t.noFilter)){if(typeof I=="object"){const Y=o||Object.keys(w);for(const A of Y){const te=Be(w,A,w),H=(C=t==null?void 0:t.customKeyFilter)==null?void 0:C[A];if(_=H?H(te,i,I):a(te,i,I),_!==-1&&_!==!1)H?f[A]=_:u[A]=_;else if((t==null?void 0:t.filterMode)==="every")continue e}}else _=a(I,i,I),_!==-1&&_!==!1&&(u.title=_);const S=Object.keys(u).length,U=Object.keys(f).length;if(!S&&!U||(t==null?void 0:t.filterMode)==="union"&&U!==m&&!S||(t==null?void 0:t.filterMode)==="intersection"&&(U!==m||!S))continue}d.push({index:s,matches:{...u,...f}})}return d}function Tt(e,i,t,d){const a=B([]),o=B(new Map),m=E(()=>d!=null&&d.transform?Q(i).map(s=>[s,d.transform(s)]):Q(i));Re(()=>{const s=typeof t=="function"?t():Q(t),I=typeof s!="string"&&typeof s!="number"?"":String(s),w=St(m.value,I,{customKeyFilter:{...e.customKeyFilter,...Q(d==null?void 0:d.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),f=Q(i),u=[],_=new Map;w.forEach(S=>{let{index:U,matches:Y}=S;const A=f[U];u.push(A),_.set(A.value,Y)}),a.value=u,o.value=_});function C(s){return o.value.get(s.value)}return{filteredItems:a,filteredMatches:o,getMatches:C}}function Ft(e,i,t){if(i==null)return e;if(Array.isArray(i))throw new Error("Multiple matches is not implemented");return typeof i=="number"&&~i?l(z,null,[l("span",{class:"v-autocomplete__unmask"},[e.substr(0,i)]),l("span",{class:"v-autocomplete__mask"},[e.substr(i,t)]),l("span",{class:"v-autocomplete__unmask"},[e.substr(i+t)])]):e}const Mt=Ve({autoSelectFirst:{type:[Boolean,String]},search:String,...kt({filterKeys:["title"]}),...it(),...ze(ut({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...gt({transition:!1})},"VAutocomplete"),Ut=Ye()({name:"VAutocomplete",props:Mt(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,i){let{slots:t}=i;const{t:d}=He(),a=B(),o=W(!1),m=W(!0),C=W(!1),s=B(),I=B(),w=de(e,"menu"),f=E({get:()=>w.value,set:n=>{var c;w.value&&!n&&((c=s.value)!=null&&c.ΨopenChildren)||(w.value=n)}}),u=W(-1),_=E(()=>{var n;return(n=a.value)==null?void 0:n.color}),S=E(()=>f.value?e.closeText:e.openText),{items:U,transformIn:Y,transformOut:A}=vt(e),{textColorClasses:te,textColorStyles:H}=dt(_),V=de(e,"search",""),v=de(e,"modelValue",[],n=>Y(n===null?[null]:he(n)),n=>{const c=A(n);return e.multiple?c:c[0]??null}),K=ct(),{filteredItems:se,getMatches:Fe}=Tt(e,U,()=>m.value?"":V.value),D=E(()=>e.hideSelected?se.value.filter(n=>!v.value.some(c=>c.value===n.value)):se.value),Me=E(()=>v.value.map(n=>n.props.value)),le=E(()=>{var c;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&V.value===((c=D.value[0])==null?void 0:c.title))&&D.value.length>0&&!m.value&&!C.value}),ue=E(()=>e.hideNoData&&!U.value.length||e.readonly||(K==null?void 0:K.isReadonly.value)),ce=B(),{onListScroll:Ue,onListKeydown:Ae}=at(ce,a);function De(n){e.openOnClear&&(f.value=!0),V.value=""}function Ee(){ue.value||(f.value=!0)}function Le(n){ue.value||(o.value&&(n.preventDefault(),n.stopPropagation()),f.value=!f.value)}function Ne(n){var R,h,x;if(e.readonly||K!=null&&K.isReadonly.value)return;const c=a.value.selectionStart,y=v.value.length;if((u.value>-1||["Enter","ArrowDown","ArrowUp"].includes(n.key))&&n.preventDefault(),["Enter","ArrowDown"].includes(n.key)&&(f.value=!0),["Escape"].includes(n.key)&&(f.value=!1),le.value&&["Enter","Tab"].includes(n.key)&&j(D.value[0]),n.key==="ArrowDown"&&le.value&&((R=ce.value)==null||R.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(n.key)){if(u.value<0){n.key==="Backspace"&&!V.value&&(u.value=y-1);return}const b=u.value,T=v.value[u.value];T&&!T.props.disabled&&j(T),u.value=b>=y-1?y-2:b}if(n.key==="ArrowLeft"){if(u.value<0&&c>0)return;const b=u.value>-1?u.value-1:y-1;v.value[b]?u.value=b:(u.value=-1,a.value.setSelectionRange((h=V.value)==null?void 0:h.length,(x=V.value)==null?void 0:x.length))}if(n.key==="ArrowRight"){if(u.value<0)return;const b=u.value+1;v.value[b]?u.value=b:(u.value=-1,a.value.setSelectionRange(0,0))}}}function Pe(n){V.value=n.target.value}function je(n){if(Ce(a.value,":autofill")||Ce(a.value,":-webkit-autofill")){const c=U.value.find(y=>y.title===n.target.value);c&&j(c)}}function Ge(){var n;o.value&&(m.value=!0,(n=a.value)==null||n.focus())}function qe(n){o.value=!0,setTimeout(()=>{C.value=!0})}function Oe(n){C.value=!1}function Ke(n){(n==null||n===""&&!e.multiple)&&(v.value=[])}const J=W(!1);function j(n){if(e.multiple){const c=v.value.findIndex(y=>e.valueComparator(y.value,n.value));if(c===-1)v.value=[...v.value,n];else{const y=[...v.value];y.splice(c,1),v.value=y}}else v.value=[n],J.value=!0,V.value=n.title,f.value=!1,m.value=!0,be(()=>J.value=!1)}return me(o,(n,c)=>{var y;n!==c&&(n?(J.value=!0,V.value=e.multiple?"":String(((y=v.value.at(-1))==null?void 0:y.props.title)??""),m.value=!0,be(()=>J.value=!1)):(!e.multiple&&!V.value?v.value=[]:le.value&&!C.value&&!v.value.some(R=>{let{value:h}=R;return h===D.value[0].value})&&j(D.value[0]),f.value=!1,V.value="",u.value=-1))}),me(V,n=>{!o.value||J.value||(n&&(f.value=!0),m.value=!n)}),me(f,()=>{if(!e.hideSelected&&f.value&&v.value.length){const n=D.value.findIndex(c=>v.value.some(y=>c.value===y.value));We&&window.requestAnimationFrame(()=>{var c;n>=0&&((c=I.value)==null||c.scrollToIndex(n))})}}),mt(()=>{const n=!!(e.chips||t.chip),c=!!(!e.hideNoData||D.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),y=v.value.length>0,R=$.filterProps(e);return l($,ne({ref:a},R,{modelValue:V.value,"onUpdate:modelValue":Ke,focused:o.value,"onUpdate:focused":h=>o.value=h,validationValue:v.externalValue,counterValue:v.value.length,dirty:y,onInput:Pe,onChange:je,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":f.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!t.selection,"v-autocomplete--selecting-index":u.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:y?void 0:e.placeholder,"onClick:clear":De,"onMousedown:control":Ee,onKeydown:Ne}),{...t,default:()=>l(z,null,[l(nt,ne({ref:s,modelValue:f.value,"onUpdate:modelValue":h=>f.value=h,activator:"parent",contentClass:"v-autocomplete__content",disabled:ue.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Ge},e.menuProps),{default:()=>[c&&l(yt,{ref:ce,selected:Me.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:h=>h.preventDefault(),onKeydown:Ae,onFocusin:qe,onFocusout:Oe,onScrollPassive:Ue,tabindex:"-1",color:e.itemColor??e.color},{default:()=>{var h,x,b;return[(h=t["prepend-item"])==null?void 0:h.call(t),!D.value.length&&!e.hideNoData&&(((x=t["no-data"])==null?void 0:x.call(t))??l(_e,{title:d(e.noDataText)},null)),l(rt,{ref:I,renderless:!0,items:D.value},{default:T=>{var pe;let{item:k,index:G,itemRef:q}=T;const ge=ne(k.props,{ref:q,key:G,active:le.value&&G===0?!0:void 0,onClick:()=>j(k)});return((pe=t.item)==null?void 0:pe.call(t,{item:k,index:G,props:ge}))??l(_e,ge,{prepend:ie=>{let{isSelected:ae}=ie;return l(z,null,[e.multiple&&!e.hideSelected?l(ot,{key:k.value,modelValue:ae,ripple:!1,tabindex:"-1"},null):void 0,k.props.prependIcon&&l(re,{icon:k.props.prependIcon},null)])},title:()=>{var ie,ae;return m.value?k.title:Ft(k.title,(ie=Fe(k))==null?void 0:ie.title,((ae=V.value)==null?void 0:ae.length)??0)}})}}),(b=t["append-item"])==null?void 0:b.call(t)]}})]}),v.value.map((h,x)=>{function b(q){q.stopPropagation(),q.preventDefault(),j(h)}const T={"onClick:close":b,onMousedown(q){q.preventDefault(),q.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},k=n?!!t.chip:!!t.selection,G=k?Je(n?t.chip({item:h,index:x,props:T}):t.selection({item:h,index:x})):void 0;if(!(k&&!G))return l("div",{key:h.value,class:["v-autocomplete__selection",x===u.value&&["v-autocomplete__selection--selected",te.value]],style:x===u.value?H.value:{}},[n?t.chip?l(ft,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:h.title}}},{default:()=>[G]}):l(st,ne({key:"chip",closable:e.closableChips,size:"small",text:h.title,disabled:h.props.disabled},T),null):G??l("span",{class:"v-autocomplete__selection-text"},[h.title,e.multiple&&x<v.value.length-1&&l("span",{class:"v-autocomplete__selection-comma"},[ve(",")])])])})]),"append-inner":function(){var T;for(var h=arguments.length,x=new Array(h),b=0;b<h;b++)x[b]=arguments[b];return l(z,null,[(T=t["append-inner"])==null?void 0:T.call(t,...x),e.menuIcon?l(re,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:Le,onClick:Qe,"aria-label":d(S.value),title:d(S.value)},null):void 0])}})}),ht({isFocused:o,isPristine:m,menu:f,search:V,filteredItems:se,select:j},a)}}),At={class:"text-h4 font-weight-bold"};function Dt(e,i,t,d,a,o){return F(),L(Z,null,{default:r(()=>[l(oe,{class:"text-center"},{default:r(()=>[l(g,{class:"d-flex align-center justify-center"},{default:r(()=>[l(p,null,{default:r(()=>[l(lt,null,{default:r(()=>[O("h2",At,"Agregar un Videojuego a la colección "+X(t.nameCollection),1),l(Z,null,{default:r(()=>[l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l(Ut,{label:"Buscar un título",modelValue:a.gameOptionSelected,"onUpdate:modelValue":[i[0]||(i[0]=m=>a.gameOptionSelected=m),o.handleGameSelected],items:a.igdbGameList,variant:"outlined","item-text":"title","item-value":"id",onInput:o.handleGameInput,onBlur:o.clearGameInput},null,8,["modelValue","items","onUpdate:modelValue","onInput","onBlur"])]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"auto"},{default:r(()=>[l(P,{class:"ma-2",text:"Cancelar",onClick:i[1]||(i[1]=m=>e.$router.push({name:"CollectionDetail",params:{id:t.idCollection}}))}),l(P,{disabled:!o.isValid,class:"bg-amber ma-2",text:"Guardar",onClick:i[2]||(i[2]=m=>o.create())},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Et=ee(xt,[["render",Dt]]),Lt={props:{idUser:{type:Number,required:!0},idItem:{type:Number,required:!0}},components:{ModalConfirm:ye},data(){return{images:[],loading:!1,mediaUrl:Xe}},methods:{async fetchItemImages(){this.loading=!0;try{this.images=await M.fetchImages(this.idUser,this.idItem)}catch(e){console.error(e)}finally{this.loading=!1}},async del(e){this.loading=!0;try{await M.removeImage(e.name,e.id,this.idUser)}catch(i){console.error(i)}finally{await this.fetchItemImages(),this.loading=!1}}},async mounted(){await this.fetchItemImages()}};function Nt(e,i,t,d,a,o){const m=N("ModalConfirm");return F(),L(Z,null,{default:r(()=>[l(oe,{class:"text-center"},{default:r(()=>[l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"auto"},{default:r(()=>[(F(!0),xe(z,null,Ze(a.images,(C,s)=>(F(),L(Ct,{key:s,class:"pa-2 ma-2"},{default:r(()=>[l(pt,{width:400,src:`${a.mediaUrl}/${C.name}`},null,8,["src"]),l(m,{buttonOpenText:"",buttonOkText:"Eliminar",buttonKoText:"Cancelar",title:"Confirma que deseas eliminar",description:"La imagen será eliminada definitivamente.","button-bg":"bg-red",icon:"mdi-delete",onAgree:I=>o.del(C)},null,8,["onAgree"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})}const Te=ee(Lt,[["render",Nt]]),Pt={props:{id:{type:Number,required:!1},currentTitle:{type:String,required:!1},nameCollection:{type:String,required:!0},idCollection:{type:Number,required:!0},idItemType:{type:Number,required:!0},idUser:{type:Number,required:!0}},components:{ModalConfirm:ye,ItemImageEdit:Te},data(){return{loading:!1,valid:!1,pageTitle:"",title:this.currentTitle||"",typeLabel:e=>Se(e)}},methods:{save(){this.id?this.update():this.create()},async create(){this.loading=!0;try{const e={idcollection:this.idCollection,iditemtype:this.idItemType,iduser:this.idUser,title:this.title};await M.create(e),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},async update(){this.loading=!0;try{await M.update(this.id||0,this.idUser,this.title,"",0),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},async del(){this.loading=!0;try{await M.remove(this.id||0,this.idUser),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},cancel(){this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}},computed:{idValid(){return!!this.title&&this.title.length>0}},watch:{currentTitle:{immediate:!0,handler(e){this.title=e}}}},jt={class:"text-h4 font-weight-bold text-center"};function Gt(e,i,t,d,a,o){const m=N("ItemImageEdit"),C=N("ModalConfirm");return F(),L(Z,null,{default:r(()=>[l(oe,{class:"text-center"},{default:r(()=>[l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"18"},{default:r(()=>[O("h1",jt,X(t.id?"Editar":"Agregar nuevo item a "+t.nameCollection),1)]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l($,{modelValue:a.title,"onUpdate:modelValue":i[0]||(i[0]=s=>a.title=s),label:"Título",required:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[O("p",null,X(a.typeLabel(t.idItemType)),1)]),_:1})]),_:1}),l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l(P,{onClick:i[1]||(i[1]=s=>e.$router.push({name:"Photo",params:{id:t.id}})),class:"bg-amber mt-2"},{default:r(()=>[l(re,{icon:"mdi-camera",size:"large",start:""}),ve(" Agregar Foto ")]),_:1})]),_:1})]),_:1}),l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l(m,{"id-item":t.id||0,"id-user":t.idUser},null,8,["id-item","id-user"])]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"auto"},{default:r(()=>[l(P,{text:"Guardar",onClick:i[2]||(i[2]=s=>o.save()),class:"bg-amber ma-2",disabled:!o.idValid},null,8,["disabled"])]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"auto"},{default:r(()=>[we(O("span",null,[l(C,{buttonOpenText:"Eliminar",buttonOkText:"Eliminar",buttonKoText:"Cancelar",title:"Confirma que deseas eliminar",description:`El item ${a.title} será eliminado de la colección ${t.nameCollection}.`,onAgree:o.del},null,8,["description","onAgree"])],512),[[ke,t.id]]),l(P,{text:"Cancelar",onClick:i[3]||(i[3]=s=>o.cancel()),class:"ma-2"})]),_:1})]),_:1})]),_:1})]),_:1})}const qt=ee(Pt,[["render",Gt]]),Ot={props:{id:{type:Number,required:!1},currentTitle:{type:String,required:!1},currentAuthor:{type:String,required:!1},currentYear:{type:Number,required:!1},nameCollection:{type:String,required:!0},idCollection:{type:Number,required:!0},idItemType:{type:Number,required:!0},idUser:{type:Number,required:!0}},components:{ModalConfirm:ye,ItemImageEdit:Te},data(){return{loading:!1,valid:!1,pageTitle:"",title:this.currentTitle||"",author:this.currentAuthor||"",year:this.currentYear||0,typeLabel:e=>Se(e)}},methods:{save(){this.id?this.update():this.create()},async create(){this.loading=!0;try{const e={idcollection:this.idCollection,iditemtype:this.idItemType,iduser:this.idUser,title:this.title,author:this.author,year:this.year};await M.create(e),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},async update(){this.loading=!0;try{await M.update(this.id||0,this.idUser,this.title,this.author,this.year),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},async del(){this.loading=!0;try{await M.remove(this.id||0,this.idUser),this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}catch(e){console.error(e)}finally{this.loading=!1}},cancel(){this.$router.push({name:"CollectionDetail",params:{id:this.idCollection}})}},computed:{idValid(){return!!this.title&&this.title.length>0}},watch:{currentTitle:{immediate:!0,handler(e){this.title=e}}}},Kt={class:"text-h4 font-weight-bold text-center"};function Rt(e,i,t,d,a,o){const m=N("ItemImageEdit"),C=N("ModalConfirm");return F(),L(Z,null,{default:r(()=>[l(oe,{class:"text-center"},{default:r(()=>[l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"18"},{default:r(()=>[O("h1",Kt,X(t.id?"Editar":"Agregar nuevo item a "+t.nameCollection),1)]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l($,{modelValue:a.title,"onUpdate:modelValue":i[0]||(i[0]=s=>a.title=s),label:"Título",required:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l($,{modelValue:a.author,"onUpdate:modelValue":i[1]||(i[1]=s=>a.author=s),label:"Autor",required:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[O("p",null,X(a.typeLabel(t.idItemType)),1)]),_:1})]),_:1}),l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l(P,{onClick:i[2]||(i[2]=s=>e.$router.push({name:"Photo",params:{id:t.id}})),class:"bg-amber mt-2"},{default:r(()=>[l(re,{icon:"mdi-camera",size:"large",start:""}),ve(" Agregar Foto ")]),_:1})]),_:1})]),_:1}),l(g,{class:"justify-center"},{default:r(()=>[l(p,{cols:"8"},{default:r(()=>[l(m,{"id-item":t.id||0,"id-user":t.idUser},null,8,["id-item","id-user"])]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"auto"},{default:r(()=>[l(P,{text:"Guardar",onClick:i[3]||(i[3]=s=>o.save()),class:"bg-amber ma-2",disabled:!o.idValid},null,8,["disabled"])]),_:1})]),_:1}),l(g,{justify:"center"},{default:r(()=>[l(p,{cols:"auto"},{default:r(()=>[we(O("span",null,[l(C,{buttonOpenText:"Eliminar",buttonOkText:"Eliminar",buttonKoText:"Cancelar",title:"Confirma que deseas eliminar",description:`El item ${a.title} será eliminado de la colección ${t.nameCollection}.`,onAgree:o.del},null,8,["description","onAgree"])],512),[[ke,t.id]]),l(P,{text:"Cancelar",onClick:i[4]||(i[4]=s=>o.cancel()),class:"ma-2"})]),_:1})]),_:1})]),_:1})]),_:1})}const Bt=ee(Ot,[["render",Rt]]),zt={components:{ItemFormGame:Et,ItemFormAny:qt,ItemFormBook:Bt},data(){var e;return{breadcrumb:[],id:parseInt(this.$route.params.id+""),idCollection:parseInt(this.$route.params.idCollection+""),idUser:parseInt(((e=$e())==null?void 0:e.id)+""),idItemType:0,idPlatform:0,nameCollection:"",item:{},collection:{},code:"",loading:!1}},methods:{async fetchItem(){this.loading=!0;try{const e=await M.fetch(this.idUser,this.id,null);this.item=e[0],this.idCollection=this.item.idcollection,this.idItemType=this.item.iditemtype,this.nameCollection=this.item.collectionname+"",this.code=Ie(this.item.iditemtype)}catch(e){console.error(e)}finally{this.loading=!1}},async fetchCollection(){this.loading=!0;try{const e=await et.fetch(this.idUser,this.idCollection);this.collection=e[0],this.idItemType=this.collection.iditemtype,this.nameCollection=this.collection.name,this.idPlatform=this.collection.idplatform,this.code=Ie(this.collection.iditemtype)}catch(e){console.error(e)}finally{this.loading=!1}}},async mounted(){this.idCollection&&(await this.fetchCollection(),this.breadcrumb=["Colecciones",this.collection.name,"Item","Nuevo"]),this.id&&(await this.fetchItem(),this.breadcrumb=["Colecciones",this.nameCollection+"",this.item.title,"Editar"])}};function Yt(e,i,t,d,a,o){var I,w,f,u,_,S;const m=N("ItemFormGame"),C=N("ItemFormBook"),s=N("ItemFormAny");return F(),xe(z,null,[l(bt,{items:a.breadcrumb},null,8,["items"]),a.code==="videogame"?(F(),L(m,{key:0,"id-collection":a.idCollection,"id-user":a.idUser,"id-item-type":a.idItemType,"id-platform":a.idPlatform,"name-collection":a.nameCollection},null,8,["id-collection","id-user","id-item-type","id-platform","name-collection"])):fe("",!0),a.code==="book"?(F(),L(C,{key:1,id:(I=a.item)==null?void 0:I.id,"current-title":(w=a.item)==null?void 0:w.title,"current-author":(f=a.item)==null?void 0:f.author,"current-year":(u=a.item)==null?void 0:u.year,"id-collection":a.idCollection,"id-user":a.idUser,"id-item-type":a.idItemType,"name-collection":a.nameCollection},null,8,["id","current-title","current-author","current-year","id-collection","id-user","id-item-type","name-collection"])):fe("",!0),a.code!=="videogame"&&a.code!=="book"?(F(),L(s,{key:2,id:(_=a.item)==null?void 0:_.id,"current-title":(S=a.item)==null?void 0:S.title,"id-collection":a.idCollection,"id-user":a.idUser,"id-item-type":a.idItemType,"name-collection":a.nameCollection},null,8,["id","current-title","id-collection","id-user","id-item-type","name-collection"])):fe("",!0)],64)}const dl=ee(zt,[["render",Yt]]);export{dl as default};
